# 📝 سجل التغييرات - Amadeus Ticket Extractor

## [4.0.2] - ديسمبر 2024

### 🔧 إصلاحات
- **إصلاح حرج:** نمط تحليل قائمة القسائم كان يتجاهل قسائم بحالات معينة
  - تحديث النمط من `([OC])` إلى `([A-Z])` لقبول جميع الحالات
  - إضافة دالة `getEMDStatusText()` لترجمة 7 حالات مختلفة
  - الآن يدعم: O (مفتوح), C (مغلق), V (صالح), R (مسترد), X (ملغي), E (منتهي), U (مستخدم)

### 🐛 المشاكل المحلولة
- حل مشكلة: عرض نفس القسيمة مكررة 10 مرات بدلاً من عرض جميع القسائم
- حل مشكلة: تجاهل القسائم ذات الحالة V أو R أو X
- حل مشكلة: "⚠️ سطر يحتوي على رقم قسيمة لكن لم يطابق النمط" للقسائم الصالحة

### ✨ تحسينات
- **رسائل Console محسّنة:**
  - عرض حالة كل قسيمة عند التحليل
  - تسهيل تشخيص مشاكل التحليل

---

## [4.0.1] - ديسمبر 2024

### 🔧 إصلاحات
- **إصلاح حرج:** التمييز بين قائمة القسائم وتفاصيل القسيمة الواحدة
  - الإضافة الآن ترفض النصوص التي تبدأ بـ `EMD-` عند البحث عن قائمة القسائم
  - تحسين دالة `isTextMatchingCommand()` لتمييز أنماط النصوص بدقة
  - نفس التحسين للتذاكر (رفض النصوص التي تبدأ بـ `TKT-`)

### ✨ تحسينات
- **رسائل تشخيص محسّنة:**
  - عرض بداية كل نص في Console (أول 80 حرف)
  - رسالة واضحة عند رفض نص
  - تسهيل تشخيص المشاكل

### 🐛 المشاكل المحلولة
- حل مشكلة: "⚠️ لم يتم العثور على قسائم في النص المستلم" عند إعادة فتح الإضافة
- حل مشكلة: جلب تفاصيل قسيمة قديمة بدلاً من قائمة القسائم الجديدة

---

## [4.0.0] - ديسمبر 2024

### ✨ ميزات جديدة
- **نظام التحقق الذكي من الأوامر:**
  - إضافة دالة `isTextMatchingCommand()` للتحقق من تطابق النص مع الأمر المرسل
  - نظام أولويات ذكي لاختيار النص الصحيح
  - تتبع آخر أمر تم إرساله ووقت إرساله

- **آلية إعادة المحاولة التلقائية:**
  - إعادة محاولة تلقائية بعد 3 ثوانٍ إذا لم تُجد نتائج
  - رسالة حالة واضحة: "🔄 إعادة محاولة جلب النتائج..."

- **أوقات انتظار محسّنة:**
  - زيادة وقت انتظار القسائم من 5 إلى 6 ثوانٍ
  - زيادة وقت انتظار التذاكر من 3 إلى 4 ثوانٍ

### 🔍 تحسينات التشخيص
- **رسائل Console مفصلة:**
  - عرض معلومات عن كل محدد مكتشف
  - رسائل واضحة عن سبب اختيار نص معين
  - تحذيرات عند اختيار نص قد لا يطابق الأمر

### 🐛 إصلاحات
- حل مشكلة عدم جلب القسائم بشكل صحيح عند إعادة فتح الإضافة
- حل مشكلة عرض نتائج قديمة بدلاً من النتائج الجديدة
- حل مشكلة الخلط بين نتائج أوامر مختلفة

---

## [3.0.0] - نوفمبر 2024

### ✨ الميزات الأساسية
- جلب القسائم (EMDs) برقم الجوال
- جلب التذاكر برقم الجوال
- عرض النتائج في جدول مبسط
- تبويبات للنص الخام والنتائج المحللة
- فلترة القسائم حسب الوصف

### 📊 الجداول
- **جدول القسائم:** رقم القسيمة، الاسم، الحالة، التاريخ، الوصف، القيمة
- **جدول التذاكر:** رقم التذكرة، الاسم، الحالة، التاريخ، المسار، السعر

---

## 🔮 الخطط المستقبلية

### قيد الدراسة
- [ ] حفظ سجل البحث باستخدام chrome.storage
- [ ] أوقات انتظار قابلة للتخصيص
- [ ] زر "إعادة المحاولة يدوياً"
- [ ] استخدام MutationObserver بدلاً من أوقات الانتظار الثابتة
- [ ] وضع تطوير مع رسائل تشخيص إضافية

### أفكار للمستقبل
- [ ] دعم البحث بأرقام التذاكر مباشرة
- [ ] تصدير النتائج إلى Excel/CSV
- [ ] إشعارات عند اكتمال العملية
- [ ] دعم لغات إضافية (إنجليزي)
- [ ] وضع داكن (Dark Mode)

---

## 📊 إحصائيات الإصدارات

| الإصدار | التاريخ | الملفات المعدلة | الأسطر المضافة | الأسطر المحذوفة |
|---------|---------|-----------------|----------------|-----------------|
| 4.0.2 | ديسمبر 2024 | 2 | +20 | -5 |
| 4.0.1 | ديسمبر 2024 | 2 | +35 | -8 |
| 4.0.0 | ديسمبر 2024 | 2 | +150 | -20 |
| 3.0.0 | نوفمبر 2024 | - | - | - |

---

## 🙏 شكر خاص

- **المستخدمون:** شكراً لتقاريركم عن المشاكل والاقتراحات
- **المطورون:** شكراً لمساهماتكم في تحسين الكود
- **المختبرون:** شكراً لاختباركم الدقيق للإصدارات الجديدة

---

**آخر تحديث:** ديسمبر 2024  
**الإصدار الحالي:** 4.0.2  
**الحالة:** ✅ مستقر وجاهز للإنتاج
